{% extends 'layout.html' %}


{% block link %}
  <script src="../static/js/socket.js"></script>
  <script src="../static/js/localStorage.js"></script>
  <script src="../static/js/functions.js"></script>
  <link rel="stylesheet" href="../static/css/chat.css">

{%endblock%}
{%block title%}
    chat app
{% endblock %}

{% block body %}   

<div class="row">
      
    <!--SIDEBAR     channel-btn-->

  
    <div class="col-md-3 hashtag bg-black bs-sidebar">

             <!-- sidebar head -->
        <h3 class="sidebar-head"> <strong>#Channels</strong>
        <button class="float-right btn d-inline" type="button" data-toggle="modal" data-target="#channelCreation" aria-expanded="false" aria-controls="collapseExample">
          <i class="fas fa-2x fa-plus-circle"></i> </button>
        </h3>
        

        <!--  MODAL FOR NEW CHANNEL CREATION -->

        <div class="modal fade" id="channelCreation" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
          <div class="modal-dialog">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="exampleModalLabel">Create New Channel</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
              <div class="modal-body">
<!-- onsubmit="createNewChannelFunction()" -->
                <form id="CreateNewChannel" class="text-dark  justify-content-center">
                   <!-- Channel_Name -->
                   <div class="form-group">
                    <label for="channel_name" class="text-dark">Channel Name</label>
                    <input type="text" id="channel_name" class="form-control border-top-0 border-left-0 border-right-0 border-dark" placeholder="#ChannelName" autocomplete="off" required/>
                    <small class="text-red channelInvalidInput font-weight-bold text-danger"><hr/></small>
                    <small class="form-text text-muted">Your channel name must starts with <strong>#</strong> and should be 6-20 characters long containing letters and numbers, and must not contain spaces, special characters or emoji.</small>
                  </div>

                  <!-- Channel Discription  -->
                  <div class="form-group">
                    <label for="channel_discription">Discription about this channel</label>
                    <textarea  id="channel_discription" class="form-control border-top-0 border-left-0 border-right-0 border-dark" cols="5" rows="2" placeholder="type here" autocomplete="off"></textarea>
                  </div> 

                  <hr/>
                  <div class="form-group">
                    <button type="submit" class="btn btn-outline-success form-control">Submit</button>
                  </div>                  
                </form>
              </div>
              
            </div>
          </div>
        </div>
 


        <!--  -->
        <div class="sidebar-ulist">
        <ul class="list-group" id="ulist">
            <!-- <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Porta ac consectetur ac </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Vestibulum at eros      </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Cras justo odio         </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Dapibus ac facilisis in </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Morbi leo risus         </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Porta ac consectetur ac </div>  </a>
            <a onclick="chatboxheader();" href="#"> <div class="list-group-item  sidebar-list"># Vestibulum at eros      </div>  </a> --> 
        </ul>

        </div>
    </div>

    <!-- SIDEBAR ENDS -->


    <!--MAIN BODY STARTS-->

    <div class="col-md-9 main container-fluid">
        
        <div class="head">
          <div class="row">
            
            <!-- channel Name -->
            <div class="col-md-3">
              <h3 class="head-h3" id="channelName">#Channel</h3>
            </div>

            <div class="col-md-9">
              <!-- Joined users -->
              <span class="float-left d-flex align-middle">
                <i class="fas fa-2x fa-users p-1"></i>
                <h5 class="mx-1 font-weight-bold p-1 channelUsers">100</h5> 
              </span>

                <!-- search box -->
              <div class="collapse" id="inChatSearch">
                <div class="search-chat text-center" style="display: block ruby; margin: -25px 120px;">
                
                <input type="text" id="chat_search"  name="chat_search" autocomplete="off" placeholder="search"/>
                <a href="#" id="chat_search_button"> <i class="fas fa-search text-dark"></i>  </a>
              
                </div>
              </div>              

<!-- </div> -->

            <!-- dropdown for extras -->
            <div class="dropdown">
              <button class="btn btn-default dropdown" type="button" id="extras" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" style="margin-left: 85%;margin-top: -1%;">
                <span class="fas fa-ellipsis-h"></span>
              </button>
              <ul class="dropdown-menu dropdown-menu-right">
                <li><a class="dropdown-item" data-toggle="collapse" href="#userProfile">Profile</a></li>
                                    <!-- in chat Search -->
                <li><a class="dropdown-item" data-toggle="collapse" href="#inChatSearch">Search</a></li>
                <li><a class="dropdown-item" data-toggle="collapse" href="#channelWallpaper">wallpaper</a></li>
                <li class="dropdown-item btn" id="clearMessages" role="button">Clear messages</li>
                <li><a class="dropdown-item" data-toggle="collapse" href="#exitChannel">Exit channel</a></li>
                <li><a class="dropdown-item border-top" data-toggle="collapse" href="#channelAbout">About</a></li>

              </ul>
            </div>


            </div>

          </div>
        </div>


        <div class="body bg-white" style="vertical-align: middle; background-image: url(../static/images/texture.png);">

        
          <section class="text-center text-dark font-weight-bolder" style="margin: 20% 20%;">

            <h1 class="welcome">
            <img class="body-image" src="../static/images/wavingHandEmoji.png" alt="slack_logo" style="width: 60px; vertical-align: bottom;">
              Welcome!
            </h1>
            <h5 class="welcome_para"> Flack is a messaging app for teams</h5>
          </section>
         
          
          

            <!-- <div class="user1 shadow-sm rounded">
                <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
                <hr/>
                <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
              </div>
              
         <div class="user2 shadow-sm  rounded">
            <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
            <hr/>
           <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
         </div>
              
         <div class="user1 shadow-sm  rounded">
                <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
                <hr/>
                <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
              </div>
              
         <div class="user2 shadow-sm  rounded">
            <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
            <hr/>
           <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
         </div>



         <div class="user1 shadow-sm  rounded">
          <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
          <hr/>
          <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
        </div>
        
       <div class="user2 shadow-sm   rounded">
          <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
          <hr/>
         <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
       </div>
     
     
     
       <div class="user1 shadow-sm  rounded">
        <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
        <hr/>
        <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
      </div>

      <div class="user2 shadow-sm   rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
      </div>          




    <div class="user1 shadow-sm  rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
    </div>
    
    <div class="user2 shadow-sm   rounded">
    <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
    <hr/>
    <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
    </div>



    <div class="user1 shadow-sm  rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
    </div>

    <div class="user2 shadow-sm   rounded">
    <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
    <hr/>
    <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
    </div>



    <div class="user1 shadow-sm  rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
    </div>

    <div class="user2 shadow-sm   rounded">
    <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
    <hr/>
    <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
    </div>



      <div class="user1 shadow-sm  rounded">
        <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
        <hr/>
        <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
      </div>

      <div class="user2 shadow-sm  rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
      </div>


      <div class="user1 shadow-sm  rounded">
        <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
        <hr/>
        <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
      </div>

      <div class="user2 shadow-sm   rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
      </div>



      <div class="user1 shadow-sm  rounded">
        <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
        <hr/>
        <div  id="user">Lorem ipsum dolor sit amet consectetur adipisicing elit. Officia voluptatum corporis saepe beatae, rem vel est quaerat recusandae culpa dignissimos voluptates reiciendis hic nostrum deleniti minima eaque magnam, ipsa incidunt porro veritatis odio consequatur? Nemo, sequi necessitatibus, culpa earum harum expedita consectetur recusandae eum ratione tempora ullam a vitae quis.</div>
      </div>

      <div class="user2 shadow-sm   rounded">
      <div class="font-weight-bold">@username <span class="float-right"> 12:00AM </span></div>
      <hr/>
      <div>Lorem, ipsum dolor sit amet consectetur adipisicing elit. Obcaecati voluptatibus doloremque sed a dolor veniam sapiente blanditiis quibusdam, nihil sequi.</div>
      </div> -->



    </div>
       


        <!-- Submit button-->
        <div class="btm" id="btm">
            <form id="form">
                <input id="input" placeholder="type your message here" autocomplete="off" type="text" required/>
                <button class="submit btn" id="submit_button" type="submit"><i class="fas fa-paper-plane"></i></button>
            </form>
        </div>








</div>
</div>


<!-- 
  STRUCTURE
  <div class="main">
<div class="head"></div>
<div class="body"></div>
<div class="btn"></div>
</div>
 -->









{% endblock %}


{% block script %}

<script>

  // Chat Dialouge Box- Title appearance changing effects`
    var parentlist = document.querySelector('.list-group');
      parentlist.addEventListener('click',chatboxheader, false)

    function chatboxheader(event){

    
    if (event.target !== event.currentTarget) {
    
      let name = event.target.textContent     //name = channel Name
      document.querySelector('.head-h3').textContent = name

      //removing the body and its all childs
      document.querySelector('.body').remove()

      //creating new body tag
      var a = document.createElement('body')
      a.classList = 'body'
      var after = document.querySelector('.main')
      after.insertBefore(a,after.childNodes[2])

// -------------------------------------------------------------------
      var dict = JSON.parse(localStorage.getItem('users'))
      let Uname = `{{username}}`   //current user
      

      var mili_array = unsortedLocalToBody(dict,name)

      //looping through each object and passing to localmessageAppend function for displaying into the body.
      mili_array.forEach(obj => {
        
        let c = mili_array.findIndex(function(ele,index){
                //searching for the index of object

               return Number(ele.time) === Number(obj.time)
              })

        if (c !== -1) {
          let username = mili_array[c].name
          let t = mili_array[c].time
          let d = mili_array[c].data
          localmessageAppend(username,t,d)
        }

      })
      
      


// ------------------------------------------------------------------------
 }

    event.stopPropagation();        
    
    };

    //Displaying user name on the screen
    document.addEventListener('DOMContentLoaded',()=>{

      //setting up the sessinStorage for username
       var sessionUsername = `{{username}}`
       sessionStorage.setItem('username', sessionUsername) 

        updateSidebarList();

    });



    function updateSidebarList(){

        const array = JSON.parse(localStorage.getItem('channelList'))
        const ulist = document.querySelector('#ulist')
        array.forEach(element => {

            //creating element and storing it into variable
            let alink = document.createElement('a')          
            let div = document.createElement('div')
          
            //setting up properties
            alink.setAttribute('onclick','chatboxheader()')
            alink.setAttribute('href','#')

            // alink.onclick = "chatboxheader();"
            // alink.href    = "#"

            div.classList = "list-group-item  sidebar-list"
            div.textContent = "#" + element

            //appending
            alink.append(div)
            ulist.append(alink) 

        });


    };



    //New Channel storage system

    
    function createNewChannelFunction(){

      var list = JSON.parse(localStorage.getItem('channelList'))
      var templist = []
      list.forEach(e => templist.push(e))
      const newChannelName =  document.querySelector('#channel_name').value

      //checking if the channel name already exists in the list or not
      if (list.find(element => element === newChannelName ) == undefined) {
        templist.push(newChannelName)
      }
      else{
        document.querySelector('#channel_name').value = ' '
        document.querySelector('.channelInvalidInput').textContent = 'Channel already exists.'
      }

      
     //updating localStorage 
     localStorage.setItem('channelList',JSON.stringify(templist));
    //wiping the inputs
      document.querySelector('#channel_name').value = ''

    // Updating Sidebar
      updateSidebarList();
      
    };   
    
</script>

<!-- script for Clear Messages from extras -->
<script>

  const clearMessage = document.querySelector('#clearMessages')
  clearMessage.addEventListener('click',()=>{

    const userName = sessionStorage.getItem('username')
    const channelName = document.querySelector('#channelName').textContent
    var dict = JSON.parse(localStorage.getItem('users'))
    for (const key in dict) {
      if (key === userName) {
        // array of objects
        let index = dict[key].findIndex(function(ele,index){
                    return ele[channelName]
                  })
        
        if (index !== -1) {
          //assigning empty object to existing channel, in this way localStorage will be overwrite 
          // and data will be cleared
          dict[key][index][channelName] = {}
          localStorage.setItem('users',JSON.stringify(dict))
          window.location.reload(true)
        }
        
        
      }
    }
    

  })
</script>

{% endblock %}